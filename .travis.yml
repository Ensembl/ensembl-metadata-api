language: python
os: linux

python:
  - "3.8"
  - "3.9"

env:
  - TESTENV=test

services:
  - mysql

before_script:
  - pip install -r requirements-test.txt
  - pip install .
  - export PYTHONPATH=$PYTHONPATH:$PWD/src
  - mysql -u root -h 127.0.0.1 -e 'CREATE DATABASE ncbi_taxonomy; CREATE DATABASE ensembl_metadata_2020; use ncbi_taxonomy; source tests/ncbi_taxonomy.sql; use ensembl_metadata_2020; source tests/ensembl_metadata_2020;'

script:
  - if [[ "$TESTENV" == "test" ]]; then coverage run -m pytest; fi
